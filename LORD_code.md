---
title: "LORD_code"
author: "Lathan Liou"
date: "9/18/2020"
output: 
html_document:
  self_contained: no
---




 
<h2>LORD: Online FDR control based on recent discovery</h2>  <h3>Description</h3>  <p>Implements the LORD procedure for online FDR control, where LORD stands for (significance) Levels based On Recent Discovery, as presented by Javanmard and Montanari (2018) and Ramdas et al. (2017). </p>   <h3>Usage</h3>  <pre> LORD(   d,   alpha = 0.05,   gammai,   version = "++",   w0,   b0,   tau.discard = 0.5,   random = TRUE,   date.format = "%Y-%m-%d" ) </pre>   <h3>Arguments</h3>  <table summary="R argblock"> <tr valign="top"><td><code>d</code></td> <td> <p>Either a vector of p-values, or a dataframe with three columns: an identifier (&lsquo;id&rsquo;), date (&lsquo;date&rsquo;) and p-value (&lsquo;pval&rsquo;). If no column of dates is provided, then the p-values are treated as being ordered sequentially with no batches.</p> </td></tr> <tr valign="top"><td><code>alpha</code></td> <td> <p>Overall significance level of the FDR procedure, the default is 0.05.</p> </td></tr> <tr valign="top"><td><code>gammai</code></td> <td> <p>Optional vector of <i>&gamma;_i</i>. A default is provided as proposed by Javanmard and Montanari (2018), equation 31 for all versions of LORD except 'dep'. The latter is provided a default to satisfy a condition given in Javanmard and Montanari (2018), example 3.8.</p> </td></tr> <tr valign="top"><td><code>version</code></td> <td> <p>Takes values '++', 3, 'discard', or 'dep'. This specifies the version of LORD to use, and defaults to '++'.</p> </td></tr> <tr valign="top"><td><code>w0</code></td> <td> <p>Initial &lsquo;wealth&rsquo; of the procedure, defaults to <i>&alpha;/10</i>.</p> </td></tr> <tr valign="top"><td><code>b0</code></td> <td> <p>The 'payout' for rejecting a hypothesis in all versions of LORD except for '++'. Defaults to <i>&alpha; - w_0</i>.</p> </td></tr> <tr valign="top"><td><code>tau.discard</code></td> <td> <p>Optional threshold for hypotheses to be selected for testing. Must be between 0 and 1, defaults to 0.5. This is required if <code>version='discard'</code>.</p> </td></tr> <tr valign="top"><td><code>random</code></td> <td> <p>Logical. If <code>TRUE</code> (the default), then the order of the p-values in each batch (i.e. those that have exactly the same date) is randomised.</p> </td></tr> <tr valign="top"><td><code>date.format</code></td> <td> <p>Optional string giving the format that is used for dates.</p> </td></tr> </table>   <h3>Details</h3>  <p>The function takes as its input either a vector of p-values or a dataframe with three columns: an identifier (&lsquo;id&rsquo;), date (&lsquo;date&rsquo;) and p-value (&lsquo;pval&rsquo;). The case where p-values arrive in batches corresponds to multiple instances of the same date. If no column of dates is provided, then the p-values are treated as being ordered sequentially with no batches. </p> <p>The LORD procedure provably controls FDR for independent p-values (see below for dependent p-values). Given an overall significance level <i>&alpha;</i>, we choose a sequence of non-negative non-increasing numbers <i>&gamma;_i</i> that sum to 1. </p> <p>Javanmard and Montanari (2018) presented versions of LORD which differ in the way the adjusted significance thresholds <i>&alpha;_i</i> are calculated. The significance thresholds for LORD 2 are based on all previous discovery times. LORD 2 has been superseded by the algorithm given in Ramdas et al. (2017), LORD++ (<code>version='++'</code>), which is the default version. The significance thresholds for LORD 3 (<code>version=3</code>) are based on the time of the last discovery as well as the 'wealth' accumulated at that time. Finally, Tian and Ramdas (2019) presented a version of LORD (<code>version='discard'</code>) that can improve the power of the procedure in the presence of conservative nulls by adaptively &lsquo;discarding&rsquo; these p-values. </p> <p>LORD depends on constants <i>w_0</i> and (for versions 3 and 'dep') <i>b_0</i>, where <i>0 &le; w_0 &le; &alpha;</i> represents the initial &lsquo;wealth&rsquo; of the procedure and <i>b_0 &gt; 0</i> represents the &lsquo;payout&rsquo; for rejecting a hypothesis. We require <i>w_0+b_0 &le; &alpha;</i> for FDR control to hold. Version 'discard' also depends on a constant <i>&tau;</i>, where <i>&tau; \in (0,1)</i> represents the threshold for a hypothesis to be selected for testing: p-values greater than <i>&tau;</i> are implicitly &lsquo;discarded&rsquo; by the procedure. </p> <p>Note that FDR control also holds for the LORD procedure if only the p-values corresponding to true nulls are mutually independent, and independent from the non-null p-values. </p> <p>For dependent p-values, a modified LORD procedure was proposed in Javanmard and Montanari (2018), which is called be setting <code>version='dep'</code>. Given an overall significance level <i>&alpha;</i>, we choose a sequence of non-negative numbers <i>&xi;_i</i> such that they satisfy a condition given in Javanmard and Montanari (2018), example 3.8. </p> <p>Further details of the LORD procedures can be found in Javanmard and Montanari (2018), Ramdas et al. (2017) and Tian and Ramdas (2019). </p>   <h3>Value</h3>  <table summary="R valueblock"> <tr valign="top"><td><code>d.out</code></td> <td> <p> A dataframe with the original data <code>d</code> (which will be reordered if there are batches and <code>random = TRUE</code>), the LORD-adjusted significance thresholds <i>&alpha;_i</i> and the indicator function of discoveries <code>R</code>. Hypothesis <i>i</i> is rejected if the <i>i</i>-th p-value is less than or equal to <i>&alpha;_i</i>, in which case <code>R[i] = 1</code>  (otherwise <code>R[i] = 0</code>).</p> </td></tr> </table>   <h3>References</h3>  <p>Javanmard, A. and Montanari, A. (2018) Online Rules for Control of False Discovery Rate and False Discovery Exceedance. <em>Annals of Statistics</em>, 46(2):526-554. </p> <p>Ramdas, A., Yang, F., Wainwright M.J. and Jordan, M.I. (2017). Online control of the false discovery rate with decaying memory. <em>Advances in Neural Information Processing Systems 30</em>, 5650-5659. </p> <p>Tian, J. and Ramdas, A. (2019). ADDIS: an adaptive discarding algorithm for online FDR control with conservative nulls. <em>arXiv preprint</em>, <a href="https://arxiv.org/abs/1905.11465">https://arxiv.org/abs/1905.11465</a>. </p>   <h3>See Also</h3>  <p><code>LORDstar</code> presents versions of LORD for <em>asynchronous</em> testing, i.e. where each hypothesis test can itself be a sequential process and the tests can overlap in time. </p>   <h3>Examples</h3>  <pre> sample.df &lt;- data.frame( id = c('A15432', 'B90969', 'C18705', 'B49731', 'E99902',     'C38292', 'A30619', 'D46627', 'E29198', 'A41418',     'D51456', 'C88669', 'E03673', 'A63155', 'B66033'), date = as.Date(c(rep('2014-12-01',3),                 rep('2015-09-21',5),                 rep('2016-05-19',2),                 '2016-11-12',                 rep('2017-03-27',4))), pval = c(2.90e-08, 0.06743, 0.01514, 0.08174, 0.00171,         3.60e-05, 0.79149, 0.27201, 0.28295, 7.59e-08,         0.69274, 0.30443, 0.00136, 0.72342, 0.54757))  LORD(sample.df, random=FALSE)  set.seed(1); LORD(sample.df, version='dep')  set.seed(1); LORD(sample.df, version='discard')  set.seed(1); LORD(sample.df, alpha=0.1, w0=0.05)   </pre>   </body></html> 
